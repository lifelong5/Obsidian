## 渲染管线和数据 
![[Pasted image 20230129153350.png]]

## 计算

### 投影：
将三维的空间坐标转换之后经过投影得到屏幕空间的二维坐标。
#### 正交投影：
![[Pasted image 20230129154015.png]]
#### 透视投影：
![[Pasted image 20230129154026.png]]

### 光栅化：
![[Pasted image 20230129154333.png]]

### 绘制：
#### 纹理采样：
为了防止走样的发生，会进行多个采样进行插值，或者层与层之间进行插值。

## 显卡GPU
### SIMD
单指令多数据的加减运算方法，在一个指令中他的x、y、z、w都一起进行运算。
### SIMT
设计很多能进行指令运算的小元件，一个时间能进行很多条单指令。

### GPU架构
集群与集群之间可以进行数据交换
![[Pasted image 20230129160804.png]]
#### GPC图形处理集群
#### SM流式多处理器
![[Pasted image 20230129160720.png]]
执行计算

#### 数据从CPU到GPU有时间成本
尽量保证从CPU到GPU的单向传输，不要从GPU中取数据
![[Pasted image 20230129161133.png]]

#### 缓存：
能直接在自己的缓存中找到数据会很快，但是如果需要从别的地方获取就会很慢。

## 绘制
### Renderbale：可绘制的对象

### Mesh
#### 原始网格 Mesh Primitive
![[Pasted image 20230129162408.png]]
```C++
//顶点
struct Vertex
{
	Vector3 m_position;
	UByte4 m_color；
	Vector3 m_normal;
}
//三角形
struct Triangle
{
	Vertex m_vertex[3];
}
```

#### 顶点和序列缓存
将顶点都存储在一个缓冲中，不用分开存储，给顶点分配一个序列号，在三角形中就不用再次存储三角形的三个顶点信息了，只用存储顶点的序列号。
![[Pasted image 20230129163254.png]]

### Mesh中顶点的法线
临近几个三角形的法线进行插值可以计算出焦点的法线方向，但是有可能同一个顶点，不同的三角形插值出来的法线方向不一致，所以顶点的法线方向是很重要的。
![[Pasted image 20230129163630.png]]

### 材质系统：
#### 模型：
##### Phong Model
###### PBR Model
##### Subsurface Material
#### 纹理：
![[Pasted image 20230129164313.png]]

### Shader 着色器的代码：
编译成数据
![[Pasted image 20230129164540.png]]

### 绘制：
#### 单材质的对象的绘制
![[Pasted image 20230129164843.png]]
网格包括顶点信息和纹理坐标信息，以及三角形的顶点信息indexdata
计算机对于每一个顶点都按照shader中的代码进行运算，加上纹理，最终得到效果。

#### 多材质对象的绘制
![[Pasted image 20230129165223.png]]
将整个对象的indexdata根据使用的材质不同分为不同的子Mesh，对于每个子mesh使用对应的材质即可。

### 资源池
由于每个对象都需要存储这样一个流程非常的浪费，因为有的shader或者材质被多个对象使用，所以使用资源池来单独管理一类的资源。
![[Pasted image 20230129165636.png]]
在绘制的时候就只用存储对应的序列就可以了。
![[Pasted image 20230129165733.png]]

### 根据材质排序
将使用了相同的材质的submesh排序在一起，一次性交给GPU进行计算，因为在绘制不同的材质时候需要设置不同的GPU状态，状态的更改也要花费时间，相同的材质可以用相同的GPU状态进行计算，不用更改。

### 可见性裁剪
给物体一个包围盒，判断包围盒是不是在视线锥里，如果不在就裁剪掉。
#### 包围盒:
![[Pasted image 20230129170815.png]]
#### PVS:
将地图分解成小地图，在某个小地图里面只渲染能通过节点看到的某些小地图，节约。
![[Pasted image 20230129171328.png]]
![[Pasted image 20230129171344.png]]

### 纹理压缩
不能使用太高级的压缩算法，因为无法进行随机取用。
#### Block 压缩
存储一个小块的最亮和最暗，其他的部分用与这两个的距离关系进行插值。很快也很方便。
![[Pasted image 20230129172158.png]]
#### 电脑
##### BC7
###### DXTC
#### 手机
##### ASTC
##### ETC/PVRTV
